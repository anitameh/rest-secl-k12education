<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Reformat ProPublica Data into JSON</title>
    </head>
    <body>
        <!-- // <script src="scripts/underscore.js" type="text/javascript"></script> -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/queue.v1.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="libs/FileSaver.js"></script>
        <div id="vis"></div>

        <script type="text/javascript">

    		d3.csv("data/original-data.csv", function(error, data) {

    			// newdata = data.slice(0,50)
    			// console.log("got the data");
    			// console.log(data[0]);

    			var nestData = d3.nest()
	    			.key(function(d) { return d.State; })
	    			.key(function(d) { return d.District_name; })
	    			.key(function(d) { return d.School_name; })
	    			.entries(data);

	    		console.log("nestData");
	    		console.log(nestData);

	    		saveToFile(nestData, "nestData.json")
	    		// saveToFile(nestData, "subsetNestData.json");
    		})

			// saveToFile function
            var saveToFile = function(object, filename) {
		        var blob, blobText;

		        blobText = [JSON.stringify(object)];
		        console.log(blobText);
		        blob = new Blob(blobText, {
		            type: "text/plain;charset=utf-8"
		        });
		        
		        saveAs(blob, filename);
		    };
        

            

        </script>

    </body>
</html>