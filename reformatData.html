<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Reformat ProPublica Data into JSON</title>
    </head>
    <body>
        <!-- // <script src="scripts/underscore.js" type="text/javascript"></script> -->
        <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.3.3/underscore-min.js"></script>
        <script src="http://d3js.org/d3.v3.min.js"></script>
        <script src="http://d3js.org/queue.v1.min.js"></script>
        <script src="http://d3js.org/topojson.v1.min.js"></script>
        <script src="../libs/FileSaver.js"></script>
        <div id="vis"></div>

        <script type="text/javascript">


            // begin D3 code            
            d3.csv("data/original-data.csv", function(error, data){

            	// initialize variables
            	var allData = {};
            	var newFormatData = {};
            	var states = [];
            	var myvals = {};

            	// KEYS = unique states
                data.forEach( function(d) {
                	states.push(d.State);
                });

                var mykeys = _.uniq(states);

                for (var i in mykeys) {
                	newFormatData[ mykeys[i] ] = [];
                }

                // VALUES = a dictionary {district_name: {school: {secl, mech, phys, enroll} } }
                data.forEach( function(d) {

                	// create a dictionary for each district
                	var mydistrict = {};
                	var variables = {};
                	variables["dis_mech"] = parseInt(d.idea_mech_restraints)+parseInt(d.section_504_mech_restraints);
                	variables["dis_phys"] = parseInt(d.idea_phys_restraints)+parseInt(d.section_504_phys_restraints);
                	variables["dis_secl"] = parseInt(d.idea_seclusion)+parseInt(d.section_504_seclusion);
                	variables["mech"] = parseInt(d.no_dis_mech_restraints);
                	variables["phys"] = parseInt(d.no_dis_phys_restraints);
                	variables["secl"] = parseInt(d.no_dis_seclusion);
                	variables["total_enroll"] = parseInt(d.total_enrollment);
                	var school_name = d.School_name;

                	// mydistrict[d.District_name] = { school_name: variables };

                	// push dictionary to corresponding state, only if district name is not already in there
                	// if ( (newFormatData[d.State]).indexOf( d.District_name ) < 0 ) {
                	// 	(newFormatData[d.State]).push(mydistrict); // instead of pushing just the dictionary name, push the entire dictionary for this district
                	// }
                	
                });

                console.log(newFormatData);

            });
            

            // saveToFile function
            var saveToFile = function(object, filename) {
		        var blob, blobText;
		        blobText = [JSON.stringify(object)];
		        blob = new Blob(blobText, {
		            type: "text/plain;charset=utf-8"
		        });
		        saveAs(blob, filename);
		    }

        </script>

    </body>
</html>